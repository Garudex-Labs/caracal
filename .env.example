# Caracal Core - Environment Variables Example
# Copy this file to .env and customize for your environment
#
# Usage:
#   cp .env.example .env
#   # Edit .env with your values
#   docker-compose up -d

# =============================================================================
# DATABASE CONFIGURATION
# =============================================================================

# PostgreSQL database name
DB_NAME=caracal

# PostgreSQL username
DB_USER=caracal

# PostgreSQL password (CHANGE THIS IN PRODUCTION!)
DB_PASSWORD=caracal_dev_password_CHANGE_ME

# PostgreSQL port (default: 5432)
DB_PORT=5432

# Database connection pool size
DB_POOL_SIZE=10

# Maximum overflow connections beyond pool size
DB_MAX_OVERFLOW=5

# Connection pool timeout in seconds
DB_POOL_TIMEOUT=30

# =============================================================================
# REDIS CONFIGURATION
# =============================================================================

# Redis password (CHANGE THIS IN PRODUCTION!)
REDIS_PASSWORD=caracal_redis_password_CHANGE_ME

# Redis port (default: 6379)
REDIS_PORT=6379

# Redis database number (default: 0)
REDIS_DB=0

# Enable Redis SSL/TLS (true/false)
REDIS_SSL=false

# Spending cache TTL in seconds (default: 86400 = 24 hours)
REDIS_SPENDING_CACHE_TTL=86400

# Metrics cache TTL in seconds (default: 3600 = 1 hour)
REDIS_METRICS_CACHE_TTL=3600

# =============================================================================
# KAFKA CONFIGURATION
# =============================================================================

# Kafka bootstrap servers
# For development (single broker):
KAFKA_BOOTSTRAP_SERVERS=kafka:9092

# For production (3 brokers with SASL/SSL):
# KAFKA_BOOTSTRAP_SERVERS=kafka-1:9092,kafka-2:9092,kafka-3:9092

# Kafka security protocol: PLAINTEXT, SASL_SSL, SSL
KAFKA_SECURITY_PROTOCOL=PLAINTEXT

# SASL configuration (for production)
# KAFKA_SASL_MECHANISM=SCRAM-SHA-512
# KAFKA_SASL_USERNAME=caracal
# KAFKA_SASL_PASSWORD=kafka_password_CHANGE_ME

# Schema Registry URL
SCHEMA_REGISTRY_URL=http://schema-registry:8081

# =============================================================================
# MERKLE TREE CONFIGURATION
# =============================================================================

# Batch size limit (number of events per batch)
MERKLE_BATCH_SIZE_LIMIT=1000

# Batch timeout in seconds (close batch after this time)
MERKLE_BATCH_TIMEOUT_SECONDS=300

# Signing algorithm: ECDSA-P256
MERKLE_SIGNING_ALGORITHM=ECDSA-P256

# =============================================================================
# GATEWAY PROXY CONFIGURATION
# =============================================================================

# Gateway HTTPS port (default: 8443)
GATEWAY_PORT=8443

# Prometheus metrics port (default: 9090)
METRICS_PORT=9090

# Authentication mode: mtls, jwt, or api_key
AUTH_MODE=jwt

# JWT algorithm (when AUTH_MODE=jwt): RS256 or ES256
JWT_ALGORITHM=RS256

# Request timeout in seconds
REQUEST_TIMEOUT=30

# Maximum request size in megabytes
MAX_REQUEST_SIZE_MB=10

# =============================================================================
# REPLAY PROTECTION CONFIGURATION
# =============================================================================

# Enable replay protection (true/false)
ENABLE_REPLAY_PROTECTION=true

# Nonce cache TTL in seconds (default: 300 = 5 minutes)
NONCE_CACHE_TTL=300

# Maximum nonce cache size
NONCE_CACHE_SIZE=100000

# Timestamp validation window in seconds (default: 300 = 5 minutes)
TIMESTAMP_WINDOW=300

# =============================================================================
# POLICY CACHE CONFIGURATION (Degraded Mode)
# =============================================================================

# Enable policy cache for degraded mode (true/false)
ENABLE_POLICY_CACHE=true

# Policy cache TTL in seconds (default: 60 = 1 minute)
POLICY_CACHE_TTL=60

# Maximum policy cache size
POLICY_CACHE_MAX_SIZE=10000

# =============================================================================
# PROVISIONAL CHARGES CONFIGURATION
# =============================================================================

# Default provisional charge expiration in seconds (default: 300 = 5 minutes)
PROVISIONAL_CHARGE_EXPIRATION=300

# Maximum provisional charge timeout in minutes (default: 60 = 1 hour)
PROVISIONAL_CHARGE_MAX_TIMEOUT=60

# Cleanup job interval in seconds (default: 60 = 1 minute)
PROVISIONAL_CHARGE_CLEANUP_INTERVAL=60

# Cleanup batch size (default: 1000)
PROVISIONAL_CHARGE_CLEANUP_BATCH_SIZE=1000

# =============================================================================
# MCP ADAPTER CONFIGURATION
# =============================================================================

# MCP Adapter HTTP port (default: 8080)
MCP_ADAPTER_PORT=8080

# MCP servers configuration (format: name1:url1,name2:url2)
# Example: MCP_SERVERS=local:http://localhost:3000,remote:http://mcp-server:3001
MCP_SERVERS=

# MCP server timeout in seconds
MCP_SERVER_TIMEOUT=30

# =============================================================================
# CONSUMER CONFIGURATION
# =============================================================================

# Metrics aggregator port (default: 9091)
METRICS_AGGREGATOR_PORT=9091

# Anomaly detection threshold (spending > threshold * average)
ANOMALY_DETECTION_THRESHOLD=2.0

# Audit log retention in days (default: 2555 = 7 years)
AUDIT_LOG_RETENTION_DAYS=2555

# =============================================================================
# MONITORING CONFIGURATION
# =============================================================================

# Enable Prometheus metrics export (true/false)
ENABLE_PROMETHEUS_METRICS=true

# Enable structured JSON logging (true/false)
ENABLE_STRUCTURED_LOGGING=true

# =============================================================================
# LOGGING CONFIGURATION
# =============================================================================

# Log level: DEBUG, INFO, WARNING, ERROR, CRITICAL
LOG_LEVEL=INFO
