# Kubernetes ConfigMap for Caracal Core v0.2
# Requirements: 17.2, 17.4
#
# This ConfigMap stores non-sensitive configuration for Gateway Proxy
# and MCP Adapter services.
#
# Usage:
#   kubectl apply -f configmap.yaml

apiVersion: v1
kind: ConfigMap
metadata:
  name: caracal-config
  namespace: caracal
  labels:
    app.kubernetes.io/name: caracal
    app.kubernetes.io/version: "1.0.0"
    app.kubernetes.io/component: configuration
data:
  # Database Configuration
  DB_HOST: "caracal-postgres"
  DB_PORT: "5432"
  DB_NAME: "caracal"
  DB_USER: "caracal"
  DB_POOL_SIZE: "10"
  DB_MAX_OVERFLOW: "5"
  DB_POOL_TIMEOUT: "30"
  
  # Gateway Configuration
  GATEWAY_LISTEN_ADDRESS: "0.0.0.0:8443"
  AUTH_MODE: "jwt"
  LOG_LEVEL: "INFO"
  REQUEST_TIMEOUT: "30"
  MAX_REQUEST_SIZE_MB: "10"
  
  # JWT Configuration
  JWT_ALGORITHM: "RS256"
  JWT_PUBLIC_KEY_PATH: "/etc/caracal/tls/jwt_public.pem"
  
  # TLS Configuration
  TLS_CERT_FILE: "/etc/caracal/tls/server.crt"
  TLS_KEY_FILE: "/etc/caracal/tls/server.key"
  TLS_CA_FILE: "/etc/caracal/tls/ca.crt"
  
  # Replay Protection
  ENABLE_REPLAY_PROTECTION: "true"
  NONCE_CACHE_TTL: "300"
  NONCE_CACHE_SIZE: "100000"
  TIMESTAMP_WINDOW: "300"
  
  # Policy Cache (Degraded Mode)
  ENABLE_POLICY_CACHE: "true"
  POLICY_CACHE_TTL: "60"
  POLICY_CACHE_MAX_SIZE: "10000"
  
  # Provisional Charges
  PROVISIONAL_CHARGE_EXPIRATION: "300"
  PROVISIONAL_CHARGE_MAX_TIMEOUT: "60"
  PROVISIONAL_CHARGE_CLEANUP_INTERVAL: "60"
  PROVISIONAL_CHARGE_CLEANUP_BATCH_SIZE: "1000"
  
  # MCP Adapter Configuration
  MCP_LISTEN_ADDRESS: "0.0.0.0:8080"
  MCP_SERVER_TIMEOUT: "30"
  
  # MCP Servers (comma-separated name:url pairs)
  # Example: local:http://mcp-server-local:3000,remote:http://mcp-server-remote:3001
  MCP_SERVERS: ""
