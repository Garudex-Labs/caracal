# Kubernetes ConfigMap for Caracal Core v0.3
# Non-sensitive configuration for all services
#
# Usage:
#   kubectl apply -f configmap.yaml

apiVersion: v1
kind: ConfigMap
metadata:
  name: caracal-config-v03
  namespace: caracal
  labels:
    app.kubernetes.io/name: caracal
    app.kubernetes.io/version: "0.3.0"
data:
  # ============================================================================
  # DATABASE CONFIGURATION
  # ============================================================================
  DB_HOST: "caracal-postgres"
  DB_PORT: "5432"
  DB_NAME: "caracal"
  DB_USER: "caracal"
  DB_POOL_SIZE: "10"
  DB_MAX_OVERFLOW: "5"
  DB_POOL_TIMEOUT: "30"
  
  # ============================================================================
  # REDIS CONFIGURATION (v0.3)
  # ============================================================================
  REDIS_HOST: "caracal-redis"
  REDIS_PORT: "6379"
  REDIS_DB: "0"
  REDIS_SSL: "false"
  REDIS_SPENDING_CACHE_TTL: "86400"
  REDIS_METRICS_CACHE_TTL: "3600"
  
  # ============================================================================
  # KAFKA CONFIGURATION (v0.3)
  # ============================================================================
  KAFKA_BOOTSTRAP_SERVERS: "caracal-kafka-0.caracal-kafka:9092,caracal-kafka-1.caracal-kafka:9092,caracal-kafka-2.caracal-kafka:9092"
  KAFKA_SECURITY_PROTOCOL: "PLAINTEXT"
  KAFKA_AUTO_OFFSET_RESET: "earliest"
  KAFKA_ENABLE_AUTO_COMMIT: "false"
  KAFKA_ISOLATION_LEVEL: "read_committed"
  KAFKA_MAX_POLL_RECORDS: "500"
  KAFKA_SESSION_TIMEOUT_MS: "30000"
  KAFKA_ENABLE_IDEMPOTENCE: "true"
  KAFKA_ACKS: "all"
  KAFKA_MAX_IN_FLIGHT_REQUESTS: "5"
  
  # Schema Registry
  SCHEMA_REGISTRY_URL: "http://caracal-schema-registry:8081"
  
  # ============================================================================
  # MERKLE TREE CONFIGURATION (v0.3)
  # ============================================================================
  MERKLE_BATCH_SIZE_LIMIT: "1000"
  MERKLE_BATCH_TIMEOUT_SECONDS: "300"
  MERKLE_SIGNING_ALGORITHM: "ECDSA-P256"
  MERKLE_SIGNING_KEY_PATH: "/etc/caracal/keys/merkle_signing_key.pem"
  
  # ============================================================================
  # GATEWAY CONFIGURATION
  # ============================================================================
  GATEWAY_LISTEN_ADDRESS: "0.0.0.0:8443"
  AUTH_MODE: "jwt"
  LOG_LEVEL: "INFO"
  REQUEST_TIMEOUT: "30"
  MAX_REQUEST_SIZE_MB: "10"
  
  # TLS Configuration
  TLS_CERT_FILE: "/etc/caracal/tls/server.crt"
  TLS_KEY_FILE: "/etc/caracal/tls/server.key"
  TLS_CA_FILE: "/etc/caracal/tls/ca.crt"
  
  # JWT Configuration
  JWT_PUBLIC_KEY_PATH: "/etc/caracal/tls/jwt_public.pem"
  JWT_ALGORITHM: "RS256"
  
  # Replay Protection
  ENABLE_REPLAY_PROTECTION: "true"
  NONCE_CACHE_TTL: "300"
  NONCE_CACHE_SIZE: "100000"
  TIMESTAMP_WINDOW: "300"
  
  # Policy Cache
  ENABLE_POLICY_CACHE: "true"
  POLICY_CACHE_TTL: "60"
  POLICY_CACHE_MAX_SIZE: "10000"
  
  # Provisional Charges
  PROVISIONAL_CHARGE_EXPIRATION: "300"
  PROVISIONAL_CHARGE_MAX_TIMEOUT: "60"
  PROVISIONAL_CHARGE_CLEANUP_INTERVAL: "60"
  PROVISIONAL_CHARGE_CLEANUP_BATCH_SIZE: "1000"
  
  # ============================================================================
  # MCP ADAPTER CONFIGURATION
  # ============================================================================
  MCP_ADAPTER_LISTEN_ADDRESS: "0.0.0.0:8080"
  MCP_SERVER_TIMEOUT: "30"
  
  # ============================================================================
  # CONSUMER CONFIGURATION (v0.3)
  # ============================================================================
  METRICS_PORT: "9091"
  ANOMALY_DETECTION_THRESHOLD: "2.0"
  AUDIT_LOG_RETENTION_DAYS: "2555"
  
  # ============================================================================
  # MONITORING CONFIGURATION
  # ============================================================================
  ENABLE_PROMETHEUS_METRICS: "true"
  ENABLE_STRUCTURED_LOGGING: "true"
