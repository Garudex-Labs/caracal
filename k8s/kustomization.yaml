# Kustomization file for Caracal Core v0.2
# Requirements: 17.2, 17.4
#
# This file allows deploying all Caracal resources with a single command:
#   kubectl apply -k .
#
# Or with kustomize:
#   kustomize build . | kubectl apply -f -

apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

# Namespace for all resources
namespace: caracal

# Common labels applied to all resources
commonLabels:
  app.kubernetes.io/name: caracal
  app.kubernetes.io/version: "1.0.0"
  app.kubernetes.io/managed-by: kustomize

# Resources to deploy (in order)
resources:
  - namespace.yaml
  - configmap.yaml
  - secret.yaml
  - postgres-statefulset.yaml
  - gateway-deployment.yaml
  - mcp-adapter-deployment.yaml

# Images to use (can be overridden)
images:
  - name: caracal-gateway
    newName: caracal-gateway
    newTag: latest
  - name: caracal-mcp-adapter
    newName: caracal-mcp-adapter
    newTag: latest
  - name: postgres
    newName: postgres
    newTag: 14-alpine

# ConfigMap generator (optional - can generate from files)
# configMapGenerator:
#   - name: caracal-config
#     files:
#       - config.yaml

# Secret generator (optional - can generate from files)
# secretGenerator:
#   - name: caracal-tls
#     files:
#       - server.crt
#       - server.key
#       - ca.crt
#       - jwt_public.pem

# Patches (optional - for environment-specific customization)
# patchesStrategicMerge:
#   - patches/production.yaml

# Replicas (can be overridden per environment)
replicas:
  - name: caracal-gateway
    count: 3
  - name: caracal-mcp-adapter
    count: 2
